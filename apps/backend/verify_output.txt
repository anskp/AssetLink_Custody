--- Verifying Price Conversion for Asset: TEST-PRICE-1768058974845 ---
Linking asset with USD 10000...
[DEBUG] findByAssetId querying for: "TEST-PRICE-1768058974845" (type: string)
prisma:info Starting a mysql pool with 17 connections.
prisma:query SELECT `assetlink_custody`.`custody_records`.`id`, `assetlink_custody`.`custody_records`.`assetId`, `assetlink_custody`.`custody_records`.`status`, `assetlink_custody`.`custody_records`.`tenantId`, `assetlink_custody`.`custody_records`.`createdBy`, `assetlink_custody`.`custody_records`.`blockchain`, `assetlink_custody`.`custody_records`.`tokenStandard`, `assetlink_custody`.`custody_records`.`tokenAddress`, `assetlink_custody`.`custody_records`.`tokenId`, `assetlink_custody`.`custody_records`.`quantity`, `assetlink_custody`.`custody_records`.`vaultWalletId`, `assetlink_custody`.`custody_records`.`linkedAt`, `assetlink_custody`.`custody_records`.`mintedAt`, `assetlink_custody`.`custody_records`.`withdrawnAt`, `assetlink_custody`.`custody_records`.`burnedAt`, `assetlink_custody`.`custody_records`.`createdAt`, `assetlink_custody`.`custody_records`.`updatedAt` FROM `assetlink_custody`.`custody_records` WHERE (`assetlink_custody`.`custody_records`.`assetId` = ? AND 1=1) LIMIT ? OFFSET ?
[DEBUG] findByAssetId result: NOT_FOUND
prisma:query BEGIN
prisma:query INSERT INTO `assetlink_custody`.`custody_records` (`id`,`assetId`,`status`,`tenantId`,`createdBy`,`linkedAt`,`createdAt`,`updatedAt`) VALUES (?,?,?,?,?,?,?,?)
prisma:query SELECT `assetlink_custody`.`custody_records`.`id`, `assetlink_custody`.`custody_records`.`assetId`, `assetlink_custody`.`custody_records`.`status`, `assetlink_custody`.`custody_records`.`tenantId`, `assetlink_custody`.`custody_records`.`createdBy`, `assetlink_custody`.`custody_records`.`blockchain`, `assetlink_custody`.`custody_records`.`tokenStandard`, `assetlink_custody`.`custody_records`.`tokenAddress`, `assetlink_custody`.`custody_records`.`tokenId`, `assetlink_custody`.`custody_records`.`quantity`, `assetlink_custody`.`custody_records`.`vaultWalletId`, `assetlink_custody`.`custody_records`.`linkedAt`, `assetlink_custody`.`custody_records`.`mintedAt`, `assetlink_custody`.`custody_records`.`withdrawnAt`, `assetlink_custody`.`custody_records`.`burnedAt`, `assetlink_custody`.`custody_records`.`createdAt`, `assetlink_custody`.`custody_records`.`updatedAt` FROM `assetlink_custody`.`custody_records` WHERE `assetlink_custody`.`custody_records`.`id` = ? LIMIT ? OFFSET ?
prisma:query COMMIT
prisma:query BEGIN
prisma:query INSERT INTO `assetlink_custody`.`audit_logs` (`id`,`custodyRecordId`,`operationId`,`eventType`,`actor`,`metadata`,`ipAddress`,`userAgent`,`timestamp`) VALUES (?,?,?,?,?,?,?,?,?)
prisma:query SELECT `assetlink_custody`.`audit_logs`.`id`, `assetlink_custody`.`audit_logs`.`custodyRecordId`, `assetlink_custody`.`audit_logs`.`operationId`, `assetlink_custody`.`audit_logs`.`eventType`, `assetlink_custody`.`audit_logs`.`actor`, `assetlink_custody`.`audit_logs`.`metadata`, `assetlink_custody`.`audit_logs`.`ipAddress`, `assetlink_custody`.`audit_logs`.`userAgent`, `assetlink_custody`.`audit_logs`.`timestamp` FROM `assetlink_custody`.`audit_logs` WHERE `assetlink_custody`.`audit_logs`.`id` = ? LIMIT ? OFFSET ?
prisma:query COMMIT
2026-01-10 20:59:34 [[32minfo[39m]: Audit log created: ASSET_LINKED {"service":"assetlink-custody","auditLogId":"6de9ceb3-8bfc-46cf-a4e4-29f71503ec46"}
2026-01-10 20:59:34 [[32minfo[39m]: Asset linked to custody with metadata {"service":"assetlink-custody","assetId":"TEST-PRICE-1768058974845","tenantId":"023c9c2f-286c-42b3-9ffc-d0874413e6bf","createdBy":"system-verify","custodyRecordId":"da78643a-b8b0-4474-8f06-28d5eeb85a0e"}
prisma:query BEGIN
prisma:query INSERT INTO `assetlink_custody`.`asset_metadata` (`id`,`custodyRecordId`,`assetType`,`assetName`,`estimatedValue`,`estimatedValueUsd`,`estimatedValueEth`,`currency`,`valuationDate`,`documents`,`images`,`createdAt`,`updatedAt`) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)
prisma:query SELECT `assetlink_custody`.`asset_metadata`.`id`, `assetlink_custody`.`asset_metadata`.`custodyRecordId`, `assetlink_custody`.`asset_metadata`.`assetType`, `assetlink_custody`.`asset_metadata`.`assetName`, `assetlink_custody`.`asset_metadata`.`description`, `assetlink_custody`.`asset_metadata`.`manufacturer`, `assetlink_custody`.`asset_metadata`.`model`, `assetlink_custody`.`asset_metadata`.`serialNumber`, `assetlink_custody`.`asset_metadata`.`yearManufactured`, `assetlink_custody`.`asset_metadata`.`estimatedValue`, `assetlink_custody`.`asset_metadata`.`estimatedValueUsd`, `assetlink_custody`.`asset_metadata`.`estimatedValueEth`, `assetlink_custody`.`asset_metadata`.`currency`, `assetlink_custody`.`asset_metadata`.`valuationDate`, `assetlink_custody`.`asset_metadata`.`valuationMethod`, `assetlink_custody`.`asset_metadata`.`verifiedBy`, `assetlink_custody`.`asset_metadata`.`verificationDate`, `assetlink_custody`.`asset_metadata`.`verificationNotes`, `assetlink_custody`.`asset_metadata`.`documents`, `assetlink_custody`.`asset_metadata`.`images`, `assetlink_custody`.`asset_metadata`.`storageType`, `assetlink_custody`.`asset_metadata`.`customFields`, `assetlink_custody`.`asset_metadata`.`createdAt`, `assetlink_custody`.`asset_metadata`.`updatedAt` FROM `assetlink_custody`.`asset_metadata` WHERE `assetlink_custody`.`asset_metadata`.`id` = ? LIMIT ? OFFSET ?
prisma:query SELECT `assetlink_custody`.`asset_files`.`id`, `assetlink_custody`.`asset_files`.`assetMetadataId`, `assetlink_custody`.`asset_files`.`fileType`, `assetlink_custody`.`asset_files`.`filePath`, `assetlink_custody`.`asset_files`.`mimeType`, `assetlink_custody`.`asset_files`.`uploadedAt` FROM `assetlink_custody`.`asset_files` WHERE `assetlink_custody`.`asset_files`.`assetMetadataId` IN (?)
prisma:query COMMIT
2026-01-10 20:59:34 [[32minfo[39m]: Asset linked with metadata {"service":"assetlink-custody","assetId":"TEST-PRICE-1768058974845","custodyRecordId":"da78643a-b8b0-4474-8f06-28d5eeb85a0e","assetType":"WATCH"}
Asset Metadata stored: {
  estimatedValue: '10000',
  estimatedValueUsd: '10000',
  estimatedValueEth: '4.000000000000000000'
}
Î“Â£Ã  Asset ETH conversion successful
prisma:query BEGIN
prisma:query SELECT `assetlink_custody`.`custody_records`.`id` FROM `assetlink_custody`.`custody_records` WHERE (`assetlink_custody`.`custody_records`.`assetId` = ? AND 1=1) LIMIT ? OFFSET ?
prisma:query UPDATE `assetlink_custody`.`custody_records` SET `status` = ?, `updatedAt` = ? WHERE (`assetlink_custody`.`custody_records`.`id` IN (?) AND (`assetlink_custody`.`custody_records`.`assetId` = ? AND 1=1))
prisma:query SELECT `assetlink_custody`.`custody_records`.`id`, `assetlink_custody`.`custody_records`.`assetId`, `assetlink_custody`.`custody_records`.`status`, `assetlink_custody`.`custody_records`.`tenantId`, `assetlink_custody`.`custody_records`.`createdBy`, `assetlink_custody`.`custody_records`.`blockchain`, `assetlink_custody`.`custody_records`.`tokenStandard`, `assetlink_custody`.`custody_records`.`tokenAddress`, `assetlink_custody`.`custody_records`.`tokenId`, `assetlink_custody`.`custody_records`.`quantity`, `assetlink_custody`.`custody_records`.`vaultWalletId`, `assetlink_custody`.`custody_records`.`linkedAt`, `assetlink_custody`.`custody_records`.`mintedAt`, `assetlink_custody`.`custody_records`.`withdrawnAt`, `assetlink_custody`.`custody_records`.`burnedAt`, `assetlink_custody`.`custody_records`.`createdAt`, `assetlink_custody`.`custody_records`.`updatedAt` FROM `assetlink_custody`.`custody_records` WHERE `assetlink_custody`.`custody_records`.`id` = ? LIMIT ? OFFSET ?
prisma:query COMMIT

Creating listing with USD 12000...
prisma:query SELECT `assetlink_custody`.`custody_records`.`id`, `assetlink_custody`.`custody_records`.`assetId`, `assetlink_custody`.`custody_records`.`status`, `assetlink_custody`.`custody_records`.`tenantId`, `assetlink_custody`.`custody_records`.`createdBy`, `assetlink_custody`.`custody_records`.`blockchain`, `assetlink_custody`.`custody_records`.`tokenStandard`, `assetlink_custody`.`custody_records`.`tokenAddress`, `assetlink_custody`.`custody_records`.`tokenId`, `assetlink_custody`.`custody_records`.`quantity`, `assetlink_custody`.`custody_records`.`vaultWalletId`, `assetlink_custody`.`custody_records`.`linkedAt`, `assetlink_custody`.`custody_records`.`mintedAt`, `assetlink_custody`.`custody_records`.`withdrawnAt`, `assetlink_custody`.`custody_records`.`burnedAt`, `assetlink_custody`.`custody_records`.`createdAt`, `assetlink_custody`.`custody_records`.`updatedAt` FROM `assetlink_custody`.`custody_records` WHERE (`assetlink_custody`.`custody_records`.`assetId` = ? AND 1=1) LIMIT ? OFFSET ?
prisma:query SELECT `assetlink_custody`.`ownerships`.`id`, `assetlink_custody`.`ownerships`.`assetId`, `assetlink_custody`.`ownerships`.`custodyRecordId`, `assetlink_custody`.`ownerships`.`tenantId`, `assetlink_custody`.`ownerships`.`ownerId`, `assetlink_custody`.`ownerships`.`quantity`, `assetlink_custody`.`ownerships`.`purchasePrice`, `assetlink_custody`.`ownerships`.`purchasePriceUsd`, `assetlink_custody`.`ownerships`.`purchasePriceEth`, `assetlink_custody`.`ownerships`.`currency`, `assetlink_custody`.`ownerships`.`acquiredAt`, `assetlink_custody`.`ownerships`.`createdAt`, `assetlink_custody`.`ownerships`.`updatedAt` FROM `assetlink_custody`.`ownerships` WHERE ((`assetlink_custody`.`ownerships`.`assetId` = ? AND `assetlink_custody`.`ownerships`.`ownerId` = ?) AND 1=1) LIMIT ? OFFSET ?
prisma:query BEGIN
prisma:query INSERT INTO `assetlink_custody`.`ownerships` (`id`,`assetId`,`custodyRecordId`,`tenantId`,`ownerId`,`quantity`,`purchasePrice`,`purchasePriceUsd`,`purchasePriceEth`,`currency`,`acquiredAt`,`createdAt`,`updatedAt`) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)
prisma:query SELECT `assetlink_custody`.`ownerships`.`id`, `assetlink_custody`.`ownerships`.`assetId`, `assetlink_custody`.`ownerships`.`custodyRecordId`, `assetlink_custody`.`ownerships`.`tenantId`, `assetlink_custody`.`ownerships`.`ownerId`, `assetlink_custody`.`ownerships`.`quantity`, `assetlink_custody`.`ownerships`.`purchasePrice`, `assetlink_custody`.`ownerships`.`purchasePriceUsd`, `assetlink_custody`.`ownerships`.`purchasePriceEth`, `assetlink_custody`.`ownerships`.`currency`, `assetlink_custody`.`ownerships`.`acquiredAt`, `assetlink_custody`.`ownerships`.`createdAt`, `assetlink_custody`.`ownerships`.`updatedAt` FROM `assetlink_custody`.`ownerships` WHERE `assetlink_custody`.`ownerships`.`id` = ? LIMIT ? OFFSET ?
prisma:query COMMIT
2026-01-10 20:59:34 [[32minfo[39m]: Created initial ownership record for listing {"service":"assetlink-custody","assetId":"TEST-PRICE-1768058974845","ownerId":"seller-123","quantity":"1"}
prisma:query BEGIN
prisma:query INSERT INTO `assetlink_custody`.`listings` (`id`,`assetId`,`custodyRecordId`,`tenantId`,`sellerId`,`price`,`priceUsd`,`priceEth`,`currency`,`quantityListed`,`quantitySold`,`status`,`expiryDate`,`createdAt`,`updatedAt`) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
prisma:query SELECT `assetlink_custody`.`listings`.`id`, `assetlink_custody`.`listings`.`assetId`, `assetlink_custody`.`listings`.`custodyRecordId`, `assetlink_custody`.`listings`.`tenantId`, `assetlink_custody`.`listings`.`sellerId`, `assetlink_custody`.`listings`.`price`, `assetlink_custody`.`listings`.`priceUsd`, `assetlink_custody`.`listings`.`priceEth`, `assetlink_custody`.`listings`.`currency`, `assetlink_custody`.`listings`.`quantityListed`, `assetlink_custody`.`listings`.`quantitySold`, `assetlink_custody`.`listings`.`status`, `assetlink_custody`.`listings`.`expiryDate`, `assetlink_custody`.`listings`.`createdAt`, `assetlink_custody`.`listings`.`updatedAt` FROM `assetlink_custody`.`listings` WHERE `assetlink_custody`.`listings`.`id` = ? LIMIT ? OFFSET ?
prisma:query COMMIT
2026-01-10 20:59:34 [[32minfo[39m]: Listing created {"service":"assetlink-custody","listingId":"145325a7-86c2-4ae0-88ff-c5cecb66be77","assetId":"TEST-PRICE-1768058974845","sellerId":"seller-123","price":"12000"}
prisma:query BEGIN
prisma:query INSERT INTO `assetlink_custody`.`audit_logs` (`id`,`custodyRecordId`,`operationId`,`eventType`,`actor`,`metadata`,`ipAddress`,`userAgent`,`timestamp`) VALUES (?,?,?,?,?,?,?,?,?)
prisma:query SELECT `assetlink_custody`.`audit_logs`.`id`, `assetlink_custody`.`audit_logs`.`custodyRecordId`, `assetlink_custody`.`audit_logs`.`operationId`, `assetlink_custody`.`audit_logs`.`eventType`, `assetlink_custody`.`audit_logs`.`actor`, `assetlink_custody`.`audit_logs`.`metadata`, `assetlink_custody`.`audit_logs`.`ipAddress`, `assetlink_custody`.`audit_logs`.`userAgent`, `assetlink_custody`.`audit_logs`.`timestamp` FROM `assetlink_custody`.`audit_logs` WHERE `assetlink_custody`.`audit_logs`.`id` = ? LIMIT ? OFFSET ?
prisma:query COMMIT
2026-01-10 20:59:34 [[32minfo[39m]: Audit log created: LISTING_CREATED {"service":"assetlink-custody","auditLogId":"8ff0bff9-4824-4c1d-972b-e36936c6c0e7"}
Listing stored: { price: '12000', priceUsd: '12000', priceEth: '4.800000000000000000' }
Î“Â£Ã  Listing ETH conversion successful

Cleaning up test data...
prisma:query DELETE FROM `assetlink_custody`.`bids` WHERE EXISTS(SELECT `t0`.`id` FROM `assetlink_custody`.`listings` AS `t0` WHERE (`t0`.`assetId` = ? AND (`assetlink_custody`.`bids`.`listingId`) = (`t0`.`id`) AND `t0`.`id` IS NOT NULL))
prisma:query DELETE FROM `assetlink_custody`.`listings` WHERE `assetlink_custody`.`listings`.`assetId` = ?
prisma:query DELETE FROM `assetlink_custody`.`ownerships` WHERE `assetlink_custody`.`ownerships`.`assetId` = ?
prisma:query DELETE FROM `assetlink_custody`.`asset_metadata` WHERE EXISTS(SELECT `t0`.`id` FROM `assetlink_custody`.`custody_records` AS `t0` WHERE (`t0`.`assetId` = ? AND (`assetlink_custody`.`asset_metadata`.`custodyRecordId`) = (`t0`.`id`) AND `t0`.`id` IS NOT NULL))
prisma:query BEGIN
prisma:query SELECT `assetlink_custody`.`custody_records`.`id`, `assetlink_custody`.`custody_records`.`assetId`, `assetlink_custody`.`custody_records`.`status`, `assetlink_custody`.`custody_records`.`tenantId`, `assetlink_custody`.`custody_records`.`createdBy`, `assetlink_custody`.`custody_records`.`blockchain`, `assetlink_custody`.`custody_records`.`tokenStandard`, `assetlink_custody`.`custody_records`.`tokenAddress`, `assetlink_custody`.`custody_records`.`tokenId`, `assetlink_custody`.`custody_records`.`quantity`, `assetlink_custody`.`custody_records`.`vaultWalletId`, `assetlink_custody`.`custody_records`.`linkedAt`, `assetlink_custody`.`custody_records`.`mintedAt`, `assetlink_custody`.`custody_records`.`withdrawnAt`, `assetlink_custody`.`custody_records`.`burnedAt`, `assetlink_custody`.`custody_records`.`createdAt`, `assetlink_custody`.`custody_records`.`updatedAt` FROM `assetlink_custody`.`custody_records` WHERE (`assetlink_custody`.`custody_records`.`assetId` = ? AND 1=1) LIMIT ? OFFSET ?
prisma:query DELETE FROM `assetlink_custody`.`custody_records` WHERE (`assetlink_custody`.`custody_records`.`assetId` = ? AND 1=1)
prisma:query COMMIT
Cleanup complete.
